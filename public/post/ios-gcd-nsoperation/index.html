<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='æˆ‘ä»¬åœ¨ç°å®ç”Ÿæ´»ä¸­,å¾€å¾€ä¼šåœ¨ç»Ÿä¸€è°ƒæ—¶é—´çº¿ä¸ŠåŒæ—¶åšå¥½å‡ ä»¶äº‹æƒ…, æ¯”å¦‚åˆ·ç‰™çš„æ—¶å€™çœ‹æ‰‹æœº,ä¸ºäº†ä¸æµªè´¹æ—¶é—´,æˆ‘ä»¬æ€»æ˜¯åŒæ—¶è¿›è¡Œä¸¤ä»¶ä¸‰ä»¶ç”šè‡³æ›´å¤šçš„äº‹æƒ…;è€Œåœ¨ç¼–ç¨‹çš„ä¸–ç•Œä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¯ä»¶æˆ–è€…ç¡¬ä»¶ä¸Šå®ç°å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æŠ€æœ¯æ¥åšåˆ°ç±»ä¼¼ç°å®ä¸–ç•Œä¸­çš„è¡Œä¸º, è¿™å°±å«åšå¤šçº¿ç¨‹;èƒ½å¤Ÿå¤§å¤§æå‡æ•´ä½“å¤„ç†æ€§èƒ½;
å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½å®ç°äº†è¿™ç§åŠŸèƒ½,java, .net,C&#43;&#43;, phpçš„pthreadså’Œswoole,ocå½“ç„¶ä¹Ÿä¸ä¾‹å¤–, ä¸‹é¢æˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹æˆ‘ä»¬åœ¨ocä¸­ä¼šç»å¸¸ç”¨åˆ°çš„å¤šçº¿ç¨‹æŠ€æœ¯GCDå’ŒNSOperation,NSOperationQueue;
GCD GCDçš„å¥½å¤„ èƒ½å¤Ÿå……åˆ†åˆ©ç”¨iOSæˆ–è€…macOSå¤šæ ¸å¿ƒçš„ç‰¹æ€§,å¤§å¤§æé«˜æ•´ä½“çš„å¤„ç†æ€§èƒ½å’Œè®¡ç®—èƒ½åŠ›;
GCDçš„é˜Ÿåˆ—å’Œä»»åŠ¡ ä»»åŠ¡ å³ä¸€ä¸ªæ“ä½œè¡Œä¸º,æˆ–è€…æ˜¯è¦æ‰§è¡Œçš„ä»£ç å—; ç±»ä¼¼ä¹°ç¥¨çš„è¡Œä¸º,å³ä¸€ä¸ªä»»åŠ¡;
é˜Ÿåˆ— æ‰§è¡Œä»»åŠ¡çš„è°ƒåº¦æ± , ç”¨æ¥å­˜æ”¾ä»»åŠ¡,ä¸€ä¸ªä¸€ä¸ªçš„ä»»åŠ¡è¢«åˆ›å»ºå¥½ä¹‹åæ”¾å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œ; é‡‡ç”¨å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™,ç±»ä¼¼æ’é˜Ÿä¹°ç¥¨çš„è¡Œä¸º;
åŒæ­¥é˜Ÿåˆ—(sync) æ·»åŠ ä»»åŠ¡åŒæ­¥é˜Ÿåˆ—,ä»»åŠ¡ä¼šä¸€ä¸ªæ¥ç€ä¸€ä¸ªå»æ‰§è¡Œ,åä¸€ä¸ªä»»åŠ¡ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡çš„å®Œæ¯•çŠ¶æ€; åŒæ­¥é˜Ÿåˆ—ä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹; ç±»ä¼¼ä¸€ä¸ªçª—å£ä¹°ç¥¨çš„è€Œè¡Œä¸º, é•¿é•¿çš„é˜Ÿä¼åªèƒ½æ…¢æ…¢çš„ç­‰å¾…;
å¼‚æ­¥é˜Ÿåˆ—(async) ä»»åŠ¡è¢«æ·»åŠ åˆ°å¼‚æ­¥é˜Ÿåˆ—å, å¦‚æœçº¿ç¨‹å¼€å¯çš„è¶³å¤Ÿå¤š, é‚£ä¹ˆæ¯ä¸€ä¸ªä»»åŠ¡ä¸ä¼šåšä»»ä½•ç­‰å¾…. æ¯ä¸ªä»»åŠ¡éƒ½å¯å·²å¼€å¯ä¸€æ–°çš„çº¿ç¨‹å»æ‰§è¡Œ; ç±»ä¼¼å¤šä¸ªçª—å£ä¹°ç¥¨çš„è¡Œä¸º, 10ä¸ªçª—å£,10ä¸ªäººä¹°ç¥¨,ä¸€ä¸ªäººä¸€ä¸ªçª—å£, ä¸ç”¨ç­‰å¾…; å½“ç„¶å•¦, ç†è®ºä¸Šæ˜¯å¯è¡Œçš„,ä½†æ˜¯å®é™…å¼€å¯çº¿ç¨‹è¿‡å¤šä¼šå¾ˆå½±å“CPUçš„æ•ˆç‡, CPUä¼šä¸€ç›´å¯¹è°ƒåº¦æ± è¿›è¡Œè½®è¯¢; CPUå°±ç´¯æ­»äº†;æ‰€ä»¥, åˆç†å¼€å¯çº¿ç¨‹ä¸ªæ•°è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„;
GCDçš„ä½¿ç”¨ GCDçš„ä½¿ç”¨éå¸¸ç®€å•, æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—,ç„¶åå°†æƒ³è¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­;
åˆ›å»ºé˜Ÿåˆ— // ä¸²è¡Œé˜Ÿåˆ—çš„åˆ›å»ºæ–¹æ³• dispatch_queue_t queue = dispatch_queue_create(&amp;#34;com.test.gcd&amp;#34;, DISPATCH_QUEUE_SERIAL); // å¹¶å‘é˜Ÿåˆ—çš„åˆ›å»ºæ–¹æ³• dispatch_queue_t queue = dispatch_queue_create(&amp;#34;com.test.gcd&amp;#34;, DISPATCH_QUEUE_CONCURRENT); //å…¨å±€å¹¶å‘é˜Ÿåˆ— dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0) //ä¸»é˜Ÿåˆ— dispatch_queue_t queue = dispatch_get_main_queue(); ä»»åŠ¡ // åŒæ­¥æ‰§è¡Œä»»åŠ¡åˆ›å»ºæ–¹æ³• dispatch_sync(queue, ^{ // è¿™é‡Œæ”¾åŒæ­¥æ‰§è¡Œä»»åŠ¡ä»£ç  }); // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡åˆ›å»ºæ–¹æ³• dispatch_async(queue, ^{ // è¿™é‡Œæ”¾å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ä»£ç  }); å®é™…ä½¿ç”¨å½“ä¸­,ä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯å¼‚æ­¥ä»»åŠ¡&#43;å¹¶è¡Œé˜Ÿåˆ— ,'>
<title>åˆ†èº«ä¸ä¹æœ¯,Objective-Cçš„å¤šçº¿ç¨‹</title>

<link rel='canonical' href='http://47.99.84.217/post/ios-gcd-nsoperation/'>

<link rel="stylesheet" href="/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css"><meta property='og:title' content='åˆ†èº«ä¸ä¹æœ¯,Objective-Cçš„å¤šçº¿ç¨‹'>
<meta property='og:description' content='æˆ‘ä»¬åœ¨ç°å®ç”Ÿæ´»ä¸­,å¾€å¾€ä¼šåœ¨ç»Ÿä¸€è°ƒæ—¶é—´çº¿ä¸ŠåŒæ—¶åšå¥½å‡ ä»¶äº‹æƒ…, æ¯”å¦‚åˆ·ç‰™çš„æ—¶å€™çœ‹æ‰‹æœº,ä¸ºäº†ä¸æµªè´¹æ—¶é—´,æˆ‘ä»¬æ€»æ˜¯åŒæ—¶è¿›è¡Œä¸¤ä»¶ä¸‰ä»¶ç”šè‡³æ›´å¤šçš„äº‹æƒ…;è€Œåœ¨ç¼–ç¨‹çš„ä¸–ç•Œä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¯ä»¶æˆ–è€…ç¡¬ä»¶ä¸Šå®ç°å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æŠ€æœ¯æ¥åšåˆ°ç±»ä¼¼ç°å®ä¸–ç•Œä¸­çš„è¡Œä¸º, è¿™å°±å«åšå¤šçº¿ç¨‹;èƒ½å¤Ÿå¤§å¤§æå‡æ•´ä½“å¤„ç†æ€§èƒ½;
å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½å®ç°äº†è¿™ç§åŠŸèƒ½,java, .net,C&#43;&#43;, phpçš„pthreadså’Œswoole,ocå½“ç„¶ä¹Ÿä¸ä¾‹å¤–, ä¸‹é¢æˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹æˆ‘ä»¬åœ¨ocä¸­ä¼šç»å¸¸ç”¨åˆ°çš„å¤šçº¿ç¨‹æŠ€æœ¯GCDå’ŒNSOperation,NSOperationQueue;
GCD GCDçš„å¥½å¤„ èƒ½å¤Ÿå……åˆ†åˆ©ç”¨iOSæˆ–è€…macOSå¤šæ ¸å¿ƒçš„ç‰¹æ€§,å¤§å¤§æé«˜æ•´ä½“çš„å¤„ç†æ€§èƒ½å’Œè®¡ç®—èƒ½åŠ›;
GCDçš„é˜Ÿåˆ—å’Œä»»åŠ¡ ä»»åŠ¡ å³ä¸€ä¸ªæ“ä½œè¡Œä¸º,æˆ–è€…æ˜¯è¦æ‰§è¡Œçš„ä»£ç å—; ç±»ä¼¼ä¹°ç¥¨çš„è¡Œä¸º,å³ä¸€ä¸ªä»»åŠ¡;
é˜Ÿåˆ— æ‰§è¡Œä»»åŠ¡çš„è°ƒåº¦æ± , ç”¨æ¥å­˜æ”¾ä»»åŠ¡,ä¸€ä¸ªä¸€ä¸ªçš„ä»»åŠ¡è¢«åˆ›å»ºå¥½ä¹‹åæ”¾å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œ; é‡‡ç”¨å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™,ç±»ä¼¼æ’é˜Ÿä¹°ç¥¨çš„è¡Œä¸º;
åŒæ­¥é˜Ÿåˆ—(sync) æ·»åŠ ä»»åŠ¡åŒæ­¥é˜Ÿåˆ—,ä»»åŠ¡ä¼šä¸€ä¸ªæ¥ç€ä¸€ä¸ªå»æ‰§è¡Œ,åä¸€ä¸ªä»»åŠ¡ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡çš„å®Œæ¯•çŠ¶æ€; åŒæ­¥é˜Ÿåˆ—ä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹; ç±»ä¼¼ä¸€ä¸ªçª—å£ä¹°ç¥¨çš„è€Œè¡Œä¸º, é•¿é•¿çš„é˜Ÿä¼åªèƒ½æ…¢æ…¢çš„ç­‰å¾…;
å¼‚æ­¥é˜Ÿåˆ—(async) ä»»åŠ¡è¢«æ·»åŠ åˆ°å¼‚æ­¥é˜Ÿåˆ—å, å¦‚æœçº¿ç¨‹å¼€å¯çš„è¶³å¤Ÿå¤š, é‚£ä¹ˆæ¯ä¸€ä¸ªä»»åŠ¡ä¸ä¼šåšä»»ä½•ç­‰å¾…. æ¯ä¸ªä»»åŠ¡éƒ½å¯å·²å¼€å¯ä¸€æ–°çš„çº¿ç¨‹å»æ‰§è¡Œ; ç±»ä¼¼å¤šä¸ªçª—å£ä¹°ç¥¨çš„è¡Œä¸º, 10ä¸ªçª—å£,10ä¸ªäººä¹°ç¥¨,ä¸€ä¸ªäººä¸€ä¸ªçª—å£, ä¸ç”¨ç­‰å¾…; å½“ç„¶å•¦, ç†è®ºä¸Šæ˜¯å¯è¡Œçš„,ä½†æ˜¯å®é™…å¼€å¯çº¿ç¨‹è¿‡å¤šä¼šå¾ˆå½±å“CPUçš„æ•ˆç‡, CPUä¼šä¸€ç›´å¯¹è°ƒåº¦æ± è¿›è¡Œè½®è¯¢; CPUå°±ç´¯æ­»äº†;æ‰€ä»¥, åˆç†å¼€å¯çº¿ç¨‹ä¸ªæ•°è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„;
GCDçš„ä½¿ç”¨ GCDçš„ä½¿ç”¨éå¸¸ç®€å•, æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—,ç„¶åå°†æƒ³è¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­;
åˆ›å»ºé˜Ÿåˆ— // ä¸²è¡Œé˜Ÿåˆ—çš„åˆ›å»ºæ–¹æ³• dispatch_queue_t queue = dispatch_queue_create(&amp;#34;com.test.gcd&amp;#34;, DISPATCH_QUEUE_SERIAL); // å¹¶å‘é˜Ÿåˆ—çš„åˆ›å»ºæ–¹æ³• dispatch_queue_t queue = dispatch_queue_create(&amp;#34;com.test.gcd&amp;#34;, DISPATCH_QUEUE_CONCURRENT); //å…¨å±€å¹¶å‘é˜Ÿåˆ— dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0) //ä¸»é˜Ÿåˆ— dispatch_queue_t queue = dispatch_get_main_queue(); ä»»åŠ¡ // åŒæ­¥æ‰§è¡Œä»»åŠ¡åˆ›å»ºæ–¹æ³• dispatch_sync(queue, ^{ // è¿™é‡Œæ”¾åŒæ­¥æ‰§è¡Œä»»åŠ¡ä»£ç  }); // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡åˆ›å»ºæ–¹æ³• dispatch_async(queue, ^{ // è¿™é‡Œæ”¾å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ä»£ç  }); å®é™…ä½¿ç”¨å½“ä¸­,ä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯å¼‚æ­¥ä»»åŠ¡&#43;å¹¶è¡Œé˜Ÿåˆ— ,'>
<meta property='og:url' content='http://47.99.84.217/post/ios-gcd-nsoperation/'>
<meta property='og:site_name' content='ç…äººå¯¿'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='iOS' /><meta property='article:published_time' content='2019-05-03T20:48:49&#43;08:00'/><meta property='article:modified_time' content='2019-05-03T20:48:49&#43;08:00'/>
<meta name="twitter:title" content="åˆ†èº«ä¸ä¹æœ¯,Objective-Cçš„å¤šçº¿ç¨‹">
<meta name="twitter:description" content="æˆ‘ä»¬åœ¨ç°å®ç”Ÿæ´»ä¸­,å¾€å¾€ä¼šåœ¨ç»Ÿä¸€è°ƒæ—¶é—´çº¿ä¸ŠåŒæ—¶åšå¥½å‡ ä»¶äº‹æƒ…, æ¯”å¦‚åˆ·ç‰™çš„æ—¶å€™çœ‹æ‰‹æœº,ä¸ºäº†ä¸æµªè´¹æ—¶é—´,æˆ‘ä»¬æ€»æ˜¯åŒæ—¶è¿›è¡Œä¸¤ä»¶ä¸‰ä»¶ç”šè‡³æ›´å¤šçš„äº‹æƒ…;è€Œåœ¨ç¼–ç¨‹çš„ä¸–ç•Œä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¯ä»¶æˆ–è€…ç¡¬ä»¶ä¸Šå®ç°å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æŠ€æœ¯æ¥åšåˆ°ç±»ä¼¼ç°å®ä¸–ç•Œä¸­çš„è¡Œä¸º, è¿™å°±å«åšå¤šçº¿ç¨‹;èƒ½å¤Ÿå¤§å¤§æå‡æ•´ä½“å¤„ç†æ€§èƒ½;
å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½å®ç°äº†è¿™ç§åŠŸèƒ½,java, .net,C&#43;&#43;, phpçš„pthreadså’Œswoole,ocå½“ç„¶ä¹Ÿä¸ä¾‹å¤–, ä¸‹é¢æˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹æˆ‘ä»¬åœ¨ocä¸­ä¼šç»å¸¸ç”¨åˆ°çš„å¤šçº¿ç¨‹æŠ€æœ¯GCDå’ŒNSOperation,NSOperationQueue;
GCD GCDçš„å¥½å¤„ èƒ½å¤Ÿå……åˆ†åˆ©ç”¨iOSæˆ–è€…macOSå¤šæ ¸å¿ƒçš„ç‰¹æ€§,å¤§å¤§æé«˜æ•´ä½“çš„å¤„ç†æ€§èƒ½å’Œè®¡ç®—èƒ½åŠ›;
GCDçš„é˜Ÿåˆ—å’Œä»»åŠ¡ ä»»åŠ¡ å³ä¸€ä¸ªæ“ä½œè¡Œä¸º,æˆ–è€…æ˜¯è¦æ‰§è¡Œçš„ä»£ç å—; ç±»ä¼¼ä¹°ç¥¨çš„è¡Œä¸º,å³ä¸€ä¸ªä»»åŠ¡;
é˜Ÿåˆ— æ‰§è¡Œä»»åŠ¡çš„è°ƒåº¦æ± , ç”¨æ¥å­˜æ”¾ä»»åŠ¡,ä¸€ä¸ªä¸€ä¸ªçš„ä»»åŠ¡è¢«åˆ›å»ºå¥½ä¹‹åæ”¾å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œ; é‡‡ç”¨å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™,ç±»ä¼¼æ’é˜Ÿä¹°ç¥¨çš„è¡Œä¸º;
åŒæ­¥é˜Ÿåˆ—(sync) æ·»åŠ ä»»åŠ¡åŒæ­¥é˜Ÿåˆ—,ä»»åŠ¡ä¼šä¸€ä¸ªæ¥ç€ä¸€ä¸ªå»æ‰§è¡Œ,åä¸€ä¸ªä»»åŠ¡ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡çš„å®Œæ¯•çŠ¶æ€; åŒæ­¥é˜Ÿåˆ—ä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹; ç±»ä¼¼ä¸€ä¸ªçª—å£ä¹°ç¥¨çš„è€Œè¡Œä¸º, é•¿é•¿çš„é˜Ÿä¼åªèƒ½æ…¢æ…¢çš„ç­‰å¾…;
å¼‚æ­¥é˜Ÿåˆ—(async) ä»»åŠ¡è¢«æ·»åŠ åˆ°å¼‚æ­¥é˜Ÿåˆ—å, å¦‚æœçº¿ç¨‹å¼€å¯çš„è¶³å¤Ÿå¤š, é‚£ä¹ˆæ¯ä¸€ä¸ªä»»åŠ¡ä¸ä¼šåšä»»ä½•ç­‰å¾…. æ¯ä¸ªä»»åŠ¡éƒ½å¯å·²å¼€å¯ä¸€æ–°çš„çº¿ç¨‹å»æ‰§è¡Œ; ç±»ä¼¼å¤šä¸ªçª—å£ä¹°ç¥¨çš„è¡Œä¸º, 10ä¸ªçª—å£,10ä¸ªäººä¹°ç¥¨,ä¸€ä¸ªäººä¸€ä¸ªçª—å£, ä¸ç”¨ç­‰å¾…; å½“ç„¶å•¦, ç†è®ºä¸Šæ˜¯å¯è¡Œçš„,ä½†æ˜¯å®é™…å¼€å¯çº¿ç¨‹è¿‡å¤šä¼šå¾ˆå½±å“CPUçš„æ•ˆç‡, CPUä¼šä¸€ç›´å¯¹è°ƒåº¦æ± è¿›è¡Œè½®è¯¢; CPUå°±ç´¯æ­»äº†;æ‰€ä»¥, åˆç†å¼€å¯çº¿ç¨‹ä¸ªæ•°è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„;
GCDçš„ä½¿ç”¨ GCDçš„ä½¿ç”¨éå¸¸ç®€å•, æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—,ç„¶åå°†æƒ³è¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­;
åˆ›å»ºé˜Ÿåˆ— // ä¸²è¡Œé˜Ÿåˆ—çš„åˆ›å»ºæ–¹æ³• dispatch_queue_t queue = dispatch_queue_create(&amp;#34;com.test.gcd&amp;#34;, DISPATCH_QUEUE_SERIAL); // å¹¶å‘é˜Ÿåˆ—çš„åˆ›å»ºæ–¹æ³• dispatch_queue_t queue = dispatch_queue_create(&amp;#34;com.test.gcd&amp;#34;, DISPATCH_QUEUE_CONCURRENT); //å…¨å±€å¹¶å‘é˜Ÿåˆ— dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0) //ä¸»é˜Ÿåˆ— dispatch_queue_t queue = dispatch_get_main_queue(); ä»»åŠ¡ // åŒæ­¥æ‰§è¡Œä»»åŠ¡åˆ›å»ºæ–¹æ³• dispatch_sync(queue, ^{ // è¿™é‡Œæ”¾åŒæ­¥æ‰§è¡Œä»»åŠ¡ä»£ç  }); // å¼‚æ­¥æ‰§è¡Œä»»åŠ¡åˆ›å»ºæ–¹æ³• dispatch_async(queue, ^{ // è¿™é‡Œæ”¾å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ä»£ç  }); å®é™…ä½¿ç”¨å½“ä¸­,ä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯å¼‚æ­¥ä»»åŠ¡&#43;å¹¶è¡Œé˜Ÿåˆ— ,">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_huf0f369220dab0d5707a6a13ef36fbc83_37198_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥°</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">ç…äººå¯¿</a></h1>
            <h2 class="site-description">å”¯è§æœˆå¯’æ—¥æš–æ¥ç…äººå¯¿</h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>æš—è‰²æ¨¡å¼</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#gcd">GCD</a>
      <ul>
        <li><a href="#gcdçš„å¥½å¤„">GCDçš„å¥½å¤„</a></li>
        <li><a href="#gcdçš„é˜Ÿåˆ—å’Œä»»åŠ¡">GCDçš„é˜Ÿåˆ—å’Œä»»åŠ¡</a></li>
        <li><a href="#gcdçš„ä½¿ç”¨">GCDçš„ä½¿ç”¨</a></li>
        <li><a href="#çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡">çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡</a></li>
        <li><a href="#çº¿ç¨‹å®‰å…¨">çº¿ç¨‹å®‰å…¨</a></li>
        <li><a href="#æ …æ ä»»åŠ¡">æ …æ ä»»åŠ¡</a></li>
        <li><a href="#å»¶è¿Ÿæ‰§è¡Œ">å»¶è¿Ÿæ‰§è¡Œ</a></li>
        <li><a href="#ä¸€æ¬¡æ€§ä»£ç ">ä¸€æ¬¡æ€§ä»£ç </a></li>
        <li><a href="#å¿«é€Ÿè¿­ä»£">å¿«é€Ÿè¿­ä»£</a></li>
        <li><a href="#gcdé˜Ÿåˆ—ç»„">GCDé˜Ÿåˆ—ç»„</a></li>
      </ul>
    </li>
    <li><a href="#nsoperation-nsoperationqueue">NSOPeration NSOperationQueue</a>
      <ul>
        <li><a href="#nsoperationqueue">NSOperationQueue</a></li>
        <li><a href="#nsoperation">NSOperation</a></li>
        <li><a href="#ä¾èµ–æ“ä½œ">ä¾èµ–æ“ä½œ</a></li>
        <li><a href="#nsoperation-çº¿ç¨‹é€šä¿¡">NSOperation çº¿ç¨‹é€šä¿¡</a></li>
        <li><a href="#nsoperation-çº¿ç¨‹å®‰å…¨">NSOperation çº¿ç¨‹å®‰å…¨</a></li>
        <li><a href="#nsoperation-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•">NSOperation å¸¸ç”¨å±æ€§å’Œæ–¹æ³•</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ios/" >
                iOS
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/ios-gcd-nsoperation/">åˆ†èº«ä¸ä¹æœ¯,Objective-Cçš„å¤šçº¿ç¨‹</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">May 03, 2019</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 6 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>æˆ‘ä»¬åœ¨ç°å®ç”Ÿæ´»ä¸­,å¾€å¾€ä¼šåœ¨ç»Ÿä¸€è°ƒæ—¶é—´çº¿ä¸ŠåŒæ—¶åšå¥½å‡ ä»¶äº‹æƒ…, æ¯”å¦‚åˆ·ç‰™çš„æ—¶å€™çœ‹æ‰‹æœº,ä¸ºäº†ä¸æµªè´¹æ—¶é—´,æˆ‘ä»¬æ€»æ˜¯åŒæ—¶è¿›è¡Œä¸¤ä»¶ä¸‰ä»¶ç”šè‡³æ›´å¤šçš„äº‹æƒ…;è€Œåœ¨ç¼–ç¨‹çš„ä¸–ç•Œä¸­, æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¯ä»¶æˆ–è€…ç¡¬ä»¶ä¸Šå®ç°å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æŠ€æœ¯æ¥åšåˆ°ç±»ä¼¼ç°å®ä¸–ç•Œä¸­çš„è¡Œä¸º, è¿™å°±å«åšå¤šçº¿ç¨‹;èƒ½å¤Ÿå¤§å¤§æå‡æ•´ä½“å¤„ç†æ€§èƒ½;</p>
<p>å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½å®ç°äº†è¿™ç§åŠŸèƒ½,java, .net,C++, phpçš„pthreadså’Œswoole,ocå½“ç„¶ä¹Ÿä¸ä¾‹å¤–, ä¸‹é¢æˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹æˆ‘ä»¬åœ¨ocä¸­ä¼šç»å¸¸ç”¨åˆ°çš„å¤šçº¿ç¨‹æŠ€æœ¯GCDå’ŒNSOperation,NSOperationQueue;</p>
<!-- raw HTML omitted -->
<h2 id="gcd">GCD</h2>
<h3 id="gcdçš„å¥½å¤„">GCDçš„å¥½å¤„</h3>
<p>èƒ½å¤Ÿå……åˆ†åˆ©ç”¨iOSæˆ–è€…macOSå¤šæ ¸å¿ƒçš„ç‰¹æ€§,å¤§å¤§æé«˜æ•´ä½“çš„å¤„ç†æ€§èƒ½å’Œè®¡ç®—èƒ½åŠ›;</p>
<h3 id="gcdçš„é˜Ÿåˆ—å’Œä»»åŠ¡">GCDçš„é˜Ÿåˆ—å’Œä»»åŠ¡</h3>
<h4 id="ä»»åŠ¡">ä»»åŠ¡</h4>
<p>å³ä¸€ä¸ªæ“ä½œè¡Œä¸º,æˆ–è€…æ˜¯è¦æ‰§è¡Œçš„ä»£ç å—; ç±»ä¼¼ä¹°ç¥¨çš„è¡Œä¸º,å³ä¸€ä¸ªä»»åŠ¡;</p>
<h4 id="é˜Ÿåˆ—">é˜Ÿåˆ—</h4>
<p>æ‰§è¡Œä»»åŠ¡çš„è°ƒåº¦æ± , ç”¨æ¥å­˜æ”¾ä»»åŠ¡,ä¸€ä¸ªä¸€ä¸ªçš„ä»»åŠ¡è¢«åˆ›å»ºå¥½ä¹‹åæ”¾å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œ; é‡‡ç”¨å…ˆè¿›å…ˆå‡ºçš„åŸåˆ™,ç±»ä¼¼æ’é˜Ÿä¹°ç¥¨çš„è¡Œä¸º;</p>
<h5 id="åŒæ­¥é˜Ÿåˆ—sync">åŒæ­¥é˜Ÿåˆ—(sync)</h5>
<p>æ·»åŠ ä»»åŠ¡åŒæ­¥é˜Ÿåˆ—,ä»»åŠ¡ä¼šä¸€ä¸ªæ¥ç€ä¸€ä¸ªå»æ‰§è¡Œ,åä¸€ä¸ªä»»åŠ¡ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡çš„å®Œæ¯•çŠ¶æ€; åŒæ­¥é˜Ÿåˆ—ä¸ä¼šå¼€å¯æ–°çš„çº¿ç¨‹; ç±»ä¼¼ä¸€ä¸ªçª—å£ä¹°ç¥¨çš„è€Œè¡Œä¸º, é•¿é•¿çš„é˜Ÿä¼åªèƒ½æ…¢æ…¢çš„ç­‰å¾…;</p>
<h5 id="å¼‚æ­¥é˜Ÿåˆ—async">å¼‚æ­¥é˜Ÿåˆ—(async)</h5>
<p>ä»»åŠ¡è¢«æ·»åŠ åˆ°å¼‚æ­¥é˜Ÿåˆ—å, å¦‚æœçº¿ç¨‹å¼€å¯çš„è¶³å¤Ÿå¤š, é‚£ä¹ˆæ¯ä¸€ä¸ªä»»åŠ¡ä¸ä¼šåšä»»ä½•ç­‰å¾…. æ¯ä¸ªä»»åŠ¡éƒ½å¯å·²å¼€å¯ä¸€æ–°çš„çº¿ç¨‹å»æ‰§è¡Œ; ç±»ä¼¼å¤šä¸ªçª—å£ä¹°ç¥¨çš„è¡Œä¸º, 10ä¸ªçª—å£,10ä¸ªäººä¹°ç¥¨,ä¸€ä¸ªäººä¸€ä¸ªçª—å£, ä¸ç”¨ç­‰å¾…; å½“ç„¶å•¦, ç†è®ºä¸Šæ˜¯å¯è¡Œçš„,ä½†æ˜¯å®é™…å¼€å¯çº¿ç¨‹è¿‡å¤šä¼šå¾ˆå½±å“CPUçš„æ•ˆç‡, CPUä¼šä¸€ç›´å¯¹è°ƒåº¦æ± è¿›è¡Œè½®è¯¢; CPUå°±ç´¯æ­»äº†;æ‰€ä»¥, åˆç†å¼€å¯çº¿ç¨‹ä¸ªæ•°è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„;</p>
<h3 id="gcdçš„ä½¿ç”¨">GCDçš„ä½¿ç”¨</h3>
<p>GCDçš„ä½¿ç”¨éå¸¸ç®€å•, æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—,ç„¶åå°†æƒ³è¦æ‰§è¡Œçš„ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­;</p>
<h4 id="åˆ›å»ºé˜Ÿåˆ—">åˆ›å»ºé˜Ÿåˆ—</h4>
<pre tabindex="0"><code>// ä¸²è¡Œé˜Ÿåˆ—çš„åˆ›å»ºæ–¹æ³•
dispatch_queue_t queue = dispatch_queue_create(&#34;com.test.gcd&#34;, DISPATCH_QUEUE_SERIAL);
// å¹¶å‘é˜Ÿåˆ—çš„åˆ›å»ºæ–¹æ³•
dispatch_queue_t queue = dispatch_queue_create(&#34;com.test.gcd&#34;, DISPATCH_QUEUE_CONCURRENT);
//å…¨å±€å¹¶å‘é˜Ÿåˆ—
dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0)
//ä¸»é˜Ÿåˆ—
dispatch_queue_t queue = dispatch_get_main_queue();
</code></pre><h4 id="ä»»åŠ¡-1">ä»»åŠ¡</h4>
<pre tabindex="0"><code>// åŒæ­¥æ‰§è¡Œä»»åŠ¡åˆ›å»ºæ–¹æ³•
dispatch_sync(queue, ^{
    // è¿™é‡Œæ”¾åŒæ­¥æ‰§è¡Œä»»åŠ¡ä»£ç 
});
// å¼‚æ­¥æ‰§è¡Œä»»åŠ¡åˆ›å»ºæ–¹æ³•
dispatch_async(queue, ^{
    // è¿™é‡Œæ”¾å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ä»£ç 
});
</code></pre><p>å®é™…ä½¿ç”¨å½“ä¸­,ä½¿ç”¨çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯<code>å¼‚æ­¥ä»»åŠ¡+å¹¶è¡Œé˜Ÿåˆ—</code> ,</p>
<pre tabindex="0"><code>-(void)asyncWithParallelQueue{
   NSLog(@&#34;currentThread---%@&#34;,[NSThread currentThread]);  // æ‰“å°å½“å‰çº¿ç¨‹
    NSLog(@&#34;asyncConcurrent---begin&#34;);
    dispatch_queue_t queue = dispatch_queue_create(&#34;com.test.gcd&#34;, DISPATCH_QUEUE_CONCURRENT);
    dispatch_async(queue, ^{
        // è¿½åŠ ä»»åŠ¡1
        for (int i = 0; i &lt; 2; ++i) {
            [NSThread sleepForTimeInterval:2];              // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
            NSLog(@&#34;1---%@&#34;,[NSThread currentThread]);      // æ‰“å°å½“å‰çº¿ç¨‹
        }
    });
    dispatch_async(queue, ^{
        // è¿½åŠ ä»»åŠ¡2
        for (int i = 0; i &lt; 2; ++i) {
            [NSThread sleepForTimeInterval:2];              // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
            NSLog(@&#34;2---%@&#34;,[NSThread currentThread]);      // æ‰“å°å½“å‰çº¿ç¨‹
        }
    });
    dispatch_async(queue, ^{
        // è¿½åŠ ä»»åŠ¡3
        for (int i = 0; i &lt; 2; ++i) {
            [NSThread sleepForTimeInterval:2];              // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
            NSLog(@&#34;3---%@&#34;,[NSThread currentThread]);      // æ‰“å°å½“å‰çº¿ç¨‹
        }
    });
    NSLog(@&#34;asyncConcurrent---end&#34;);
    }
</code></pre><p>å¯ä»¥çœ‹åˆ°é™¤äº†ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œç³»ç»Ÿå¼€å¯äº†3ä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”ä»»åŠ¡å¯ä»¥çœ‹åšæ˜¯åŒæ—¶æ‰§è¡Œçš„ã€‚ï¼ˆå¼‚æ­¥æ‰§è¡Œå…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚ä¸”å¹¶å‘é˜Ÿåˆ—å¯å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼ŒåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼‰ã€‚æ‰€æœ‰ä»»åŠ¡æ˜¯åœ¨æ‰“å°çš„syncConcurrent&mdash;beginå’ŒsyncConcurrent&mdash;endä¹‹åæ‰æ‰§è¡Œçš„ã€‚è¯´æ˜å½“å‰çº¿ç¨‹æ²¡æœ‰ç­‰å¾…ï¼Œè€Œæ˜¯ç›´æ¥å¼€å¯äº†æ–°çº¿ç¨‹ï¼Œåœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼ˆå¼‚æ­¥æ‰§è¡Œä¸åšç­‰å¾…ï¼Œå¦‚æœå­˜åœ¨ç©ºé—²çš„çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œä»»åŠ¡ï¼‰ã€‚</p>
<h3 id="çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡">çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡</h3>
<p>å¦‚æœæˆ‘ä»¬åœ¨ä¸»çº¿ä¸­ä½¿ç”¨äº†è€—æ—¶ä»»åŠ¡ä¾‹å¦‚ä¸‹è½½,åˆæˆå›¾ç‰‡,I/Oç­‰æ“ä½œæ—¶, ä¼šå¯¹UIé€ æˆé˜»å¡, é€ æˆç•Œé¢ä¸èƒ½å“åº”è§¦æ‘¸,æ»šåŠ¨,åˆ·æ–°ç­‰å¼‚å¸¸,æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šå°†è¿™äº›è€—æ—¶æ“ä½œæ”¾åˆ°å­çº¿ç¨‹ä¸­è¿›è¡Œæ‰§è¡Œ, è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªä¸å¯é¿å…çš„é—®é¢˜,å°±æ˜¯æˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸­å¤„ç†å®Œæ“ä½œåéœ€è¦æŠŠå¤„ç†ç»“æœæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­è¿›è¡Œæ›´æ–°æ•°æ®æˆ–è€…UI,è¿™å°±ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹ä¹‹é—´é€šä¿¡çš„é—®é¢˜, ä¸‡å¹¸çš„æ˜¯,GCDå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†ç›¸åº”çš„æ–¹æ³•;</p>
<pre tabindex="0"><code>/**
 * çº¿ç¨‹é—´é€šä¿¡
 */
- (void)sendMSG{
    // è·å–å…¨å±€å¹¶å‘é˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
    // è·å–ä¸»é˜Ÿåˆ—
    dispatch_queue_t mainQueue = dispatch_get_main_queue();
    dispatch_async(queue, ^{
        // å¼‚æ­¥è¿½åŠ ä»»åŠ¡
        for (int i = 0; i &lt; 2; ++i) {
            [NSThread sleepForTimeInterval:2];              // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
            NSLog(@&#34;1---%@&#34;,[NSThread currentThread]);      // æ‰“å°å½“å‰çº¿ç¨‹
        }
        // å›åˆ°ä¸»çº¿ç¨‹
        dispatch_async(mainQueue, ^{
            // è¿½åŠ åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡
            [NSThread sleepForTimeInterval:2];              // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
            NSLog(@&#34;2---%@&#34;,[NSThread currentThread]);      // æ‰“å°å½“å‰çº¿ç¨‹
        });
    });
}
</code></pre><h3 id="çº¿ç¨‹å®‰å…¨">çº¿ç¨‹å®‰å…¨</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªå‡ºå”®è½¦ç¥¨çš„åœºæ™¯: ä½™ç¥¨500å¼ ,åŒæ—¶å­˜åœ¨ä¸¤ä¸ªæˆ–è€…å¤šä¸ªçª—å£è¿›è¡Œå”®ç¥¨,å¦‚æœæˆ‘ä»¬åŒæ—¶è®¿é—®äº†è¿™ä¸ªä½™ç¥¨å¹¶è¿›è¡Œå‡ºå”®æ˜¯ä¸æ˜¯ä¼šå­˜åœ¨é—®é¢˜å‘¢?</p>
<pre tabindex="0"><code>- (void)unSaveTicket{
    NSLog(@&#34;currentThread---%@&#34;,[NSThread currentThread]);  // æ‰“å°å½“å‰çº¿ç¨‹
    NSLog(@&#34;semaphore---begin&#34;);
    self.ticketCount = 500;
    // queue1 ä»£è¡¨å”®å–çª—å£1
    dispatch_queue_t queue1 = dispatch_queue_create(&#34;com.test.gcd&#34;, DISPATCH_QUEUE_SERIAL);
    // queue2 ä»£è¡¨å”®å–çª—å£2
    dispatch_queue_t queue2 = dispatch_queue_create(&#34;com.test.gcd&#34;, DISPATCH_QUEUE_SERIAL);
    __weak typeof(self) weakSelf = self;
    dispatch_async(queue1, ^{
        [weakSelf saleTicketunSafe];
    });
    dispatch_async(queue2, ^{
        [weakSelf saleTicketunSafe];
    });
}
/**
 * å”®å–ç«è½¦ç¥¨(éçº¿ç¨‹å®‰å…¨)
 */
- (void)saleTicketunSafe {
    while (1) {
        if (self.ticketCount &gt; 0) {  //å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–
            self.ticketCount--;
            NSLog(@&#34;%@&#34;, [NSString stringWithFormat:@&#34;å‰©ä½™ç¥¨æ•°ï¼š%d çª—å£ï¼š%@&#34;, self.ticketCount, [NSThread currentThread]]);
            [NSThread sleepForTimeInterval:0.2];
        } else { //å¦‚æœå·²å–å®Œï¼Œå…³é—­å”®ç¥¨çª—å£
            NSLog(@&#34;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&#34;);
            break;
        }
    }
}
</code></pre><p><img src="https://52smile.vip/wp-content/uploads/2019/05/15568928052630.jpg"
	
	
	
	loading="lazy"
	
		alt="-w1086"
	
	
>ï¿¼ å¯ä»¥çœ‹åˆ°,è¿™é‡Œçš„ç¥¨çš„ä¸ªæ•°æ˜¯ä¸å®‰å…¨çš„;é€ æˆè¿™æ ·çš„åŸå› æ˜¯å› ä¸ºå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªèµ„æºé€ æˆçš„,å¦‚æœæˆ‘ä»¬æƒ³è¦é¿å…è¿™ç§é—®é¢˜,æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªæ•°æ®è¿›è¡ŒåŠ é”;</p>
<pre tabindex="0"><code>/**
 * çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ synchronized åŠ é”
 * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(çº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨
 */
- (void)initTicketStatusSave {
    NSLog(@&#34;currentThread---%@&#34;,[NSThread currentThread]);  // æ‰“å°å½“å‰çº¿ç¨‹
    NSLog(@&#34;semaphore---begin&#34;);
    self.ticketCount = 50;
    // queue1 ä»£è¡¨ç¥¨å”®å–çª—å£1
    dispatch_queue_t queue1 = dispatch_queue_create(&#34;com.test.gcd&#34;, DISPATCH_QUEUE_SERIAL);
    // queue2 ä»£è¡¨å”®å–çª—å£2
    dispatch_queue_t queue2 = dispatch_queue_create(&#34;com.test.gcd&#34;, DISPATCH_QUEUE_SERIAL);
    __weak typeof(self) weakSelf = self;
    dispatch_async(queue1, ^{
        [weakSelf saleTicketSafe];
    });
    dispatch_async(queue2, ^{
        [weakSelf saleTicketSafe];
    });
}
/**
 * å”®å–ç«è½¦ç¥¨(çº¿ç¨‹å®‰å…¨)
 */
- (void)saleTicketSafe {
    while (1) {
        @synchronized (self) {
            if (self.ticketCount &gt; 0) {  //å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–
                self.ticketCount--;
                NSLog(@&#34;%@&#34;, [NSString stringWithFormat:@&#34;å‰©ä½™ç¥¨æ•°ï¼š%zd çª—å£ï¼š%@&#34;, self.ticketCount, [NSThread currentThread]]);
            } else { //å¦‚æœå·²å–å®Œï¼Œå…³é—­å”®ç¥¨çª—å£
                NSLog(@&#34;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&#34;);
                break;
            }
        }
    }
}
</code></pre><h3 id="æ …æ ä»»åŠ¡">æ …æ ä»»åŠ¡</h3>
<p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨æŸä¸ªå‡½æ•°åæ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡. è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦ç”¨åˆ°ocæä¾›çš„æ …æ å‡½æ•°'</p>
<pre tabindex="0"><code>//æ …æ ¼
-(void)barrier{
    /**
     ä¸èƒ½ä½¿ç”¨quan&#39;jue&#39;deå…¨å±€çš„å¹¶å‘é˜Ÿåˆ—. ä¼šå‡ºç°ç´Šä¹±
     æ …æ ¼å‡½æ•°ä½¿ç”¨å, åœ¨æ …æ ¼å‡½æ•°ä¹‹å‰çš„, å…ˆè¿›è¡Œæ‰§è¡Œ;
     åœ¨æ …æ ¼å‡½æ•°ä¹‹å, ç­‰å¾…æ …æ ¼å‡½æ•°æ‰§è¡Œå®Œæˆååœ¨æ‰§è¡Œ;
     */
    dispatch_queue_t queue = dispatch_queue_create(&#34;dispatch_barrier&#34;, DISPATCH_CURRENT_QUEUE_LABEL);
    dispatch_async(queue, ^{
        NSLog(@&#34;---1----%@&#34;,[NSThread currentThread]);
    });
    dispatch_async(queue, ^{
        NSLog(@&#34;---2----%@&#34;,[NSThread currentThread]);
    });
    dispatch_barrier_async(queue, ^{
        NSLog(@&#34;---barrier----%@&#34;,[NSThread currentThread]);
    });
    dispatch_async(queue, ^{
        NSLog(@&#34;---3----%@&#34;,[NSThread currentThread]);
    });
    dispatch_async(queue, ^{
        NSLog(@&#34;---4----%@&#34;,[NSThread currentThread]);
    });
}
</code></pre><p>è¿™ä¸ªæ‰§è¡Œæ˜¯æ‰§è¡Œå®Œ1,2ä¹‹åæ‰§è¡Œ<code>barrier</code>,ç„¶åç­‰å¾…<code>barrier</code>æ‰§è¡Œå®Œæˆå,æ‰§è¡Œ3,4; æ …æ ä½œä¸ºé˜»æŒ¡3,4çš„å±éšœ,ç­‰å¾…1,2 æ‰§è¡Œå®Œæˆåæ‰å¼€å§‹ä¸‹ä¸€æ­¥çš„æ‰§è¡Œ;</p>
<h3 id="å»¶è¿Ÿæ‰§è¡Œ">å»¶è¿Ÿæ‰§è¡Œ</h3>
<p>åœ¨æŒ‡å®šæŸä¸ªæ—¶é—´é—´éš”åæ‰§è¡ŒæŸæ®µä»»åŠ¡.</p>
<pre tabindex="0"><code>//å»¶æ—¶æ‰§è¡Œ
-(void)disafter{
   //å»¶æ—¶ä¸¤ç§’é’Ÿæ‰§è¡Œ run
//    [self performSelector:@selector(run:) withObject:@&#34;ä¸¤å¥½ä¸‰å&#34; afterDelay:2];
    //å¯ä»¥ä¼ å…¥å…¶ä»–é˜Ÿåˆ—
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)),
                   dispatch_get_main_queue(), ^{
                       [self run:@&#34;ä¸¤å¥½ä¸‰å&#34;];
    });
    // ä½¿ç”¨NSTimer, ä½œä¸ºå®šæ—¶å™¨è¿›è¡Œæ“ä½œ
    [NSTimer scheduledTimerWithTimeInterval:2 target:self selector:@selector(run:) userInfo:nil repeats:NO];
}
</code></pre><h3 id="ä¸€æ¬¡æ€§ä»£ç ">ä¸€æ¬¡æ€§ä»£ç </h3>
<p>æˆ‘ä»¬åœ¨åˆ›å»ºå•ä¾‹ã€æˆ–è€…æœ‰æ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªæ‰§è¡Œä¸€æ¬¡çš„ä»£ç æ—¶ï¼Œæˆ‘ä»¬å°±ç”¨åˆ°äº† GCD çš„ dispatch_once å‡½æ•°ã€‚ä½¿ç”¨ dispatch_once å‡½æ•°èƒ½ä¿è¯æŸæ®µä»£ç åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªè¢«æ‰§è¡Œ1æ¬¡ï¼Œå¹¶ä¸”å³ä½¿åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œdispatch_onceä¹Ÿå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<pre tabindex="0"><code>//ä¸€æ¬¡æ€§å‡½æ•°, ç±»ä¼¼å•ä¾‹,èµ„æºåŠ è½½ç­‰;æ³¨æ„ä¸æ‡’åŠ è½½çš„åŒºåˆ«;
-(void)onceCode{
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        NSLog(@&#34;hhhh&#34;);
    });
}
</code></pre><p>eg: å•ä¾‹:</p>
<pre tabindex="0"><code>static QKSingleton *_singleton;
/**
 è¿”å›ä¸€ä¸ªå•ä¾‹å¯¹è±¡
 @return å•ä¾‹å¯¹è±¡
 */
+(instancetype)shareSingleton{
        static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        _singleton = [[self alloc] init];
    });
    return _singleton;
}
+(instancetype)allocWithZone:(struct _NSZone *)zone{
    static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        _singleton = [super allocWithZone:zone];
    });
    return _singleton;
}
-(id)copyWithZone:(NSZone *)zone{
    return _singleton;
}
</code></pre><h3 id="å¿«é€Ÿè¿­ä»£">å¿«é€Ÿè¿­ä»£</h3>
<p>ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨forå¾ªç¯è¿›è¡Œæ•°æ®éå†,ç„¶åå†å¾ªç¯å†…å¯¹å•ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œ; è¿™æ ·çš„é—®é¢˜åœ¨äºå¦‚æœæˆ‘çš„æ•°æ®é‡è¶³å¤Ÿå¤§æˆ–è€…å•ä¸ªå…ƒç´ æ“ä½œè€—æ—¶å¾ˆé«˜,é‚£ä¹ˆåœ¨æ•ˆç‡ä¸Šä¼šå¾ˆä½,å› ä¸ºè¿™ä¸ªå®é™…ä¸Šæ˜¯åœ¨ä¸€ä¸ªæ—¶é—´çº¿çš„ä¸€ä¸ªä»»åŠ¡åˆ—ä¸­è¿›è¡Œæ“ä½œçš„,ç›¸å½“äºåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­æ‰§è¡Œä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—; è€ŒGCDä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¿«é€Ÿè¿­ä»£çš„æ–¹æ¡ˆ: åœºæ™¯å¦‚ä¸‹: æˆ‘æƒ³æŠŠ<code>From</code>æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ä¸€ä¸ªä¸€ä¸ªçš„ç§»åŠ¨æˆ–è€…å¤åˆ¶åˆ°<code>TO</code>æ–‡ä»¶å¤¹ä¸­, æˆ‘ä»¬éƒ½çŸ¥é“I/Oæ“ä½œæ˜¯å¾ˆè€—æ—¶é—´çš„. ä¸‹é¢æœ‰ä¸¤ä¸ªæ–¹æ³•,ä¸€ä¸ªæ˜¯ä½¿ç”¨æ™®é€šçš„forå¾ªç¯è¿›è¡Œéå†, ä¸€ä¸ªæ˜¯ä½¿ç”¨GCDæä¾›çš„<code>dispatch_apply</code>è¿›è¡Œæ“ä½œ;å¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹å¯¹æ¯”æ•ˆæœ;</p>
<pre tabindex="0"><code>//å¿«é€Ÿéå†
-(void)quickBlock{
    /**
     å¯ä»¥iæ›¿ä»£éƒ¨åˆ†forå¾ªç¯çš„åŠŸèƒ½;
     eg: wæƒ³å°†ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶å‰ªåˆ‡æˆ–è€…æ‹·è´åˆ°å¦å¤–ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­,å¦‚æœæˆ‘ä»¬é€šè¿‡forå¾ªç¯
     å»åšè¿™ä»¶äº‹æƒ…,å½“æ–‡ä»¶æ•°é‡è¾¾åˆ°ä¸€å®šçš„æ•°é‡çš„æ—¶å€™æ•ˆç‡è‚¯å®šé™ä½; ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä½¿ç”¨GCDè¿›è¡Œ
     å¤„ç†, ä¼šå¥½å¾ˆå¤š;
     */
    // ä½¿ç”¨å¸¸è§„æ“ä½œç§»åŠ¨æ–‡ä»¶
    // [self  normalMoveFile];
    // ä½¿ç”¨ GCD ç§»åŠ¨æ–‡ä»¶
//    [self applayGCDMoveFile];
}
//ä½¿ç”¨ GCD ç§»åŠ¨æ–‡ä»¶, å¿«é€Ÿéå†
-(void)applayGCDMoveFile{
    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
    // å¸¸è§„æ“ä½œ
    NSFileManager *mgr = [NSFileManager defaultManager];
    NSString *fromPath = @&#34;/User/su/Desktop/Form&#34;;
    NSString *toPath = @&#34;/User/su/Desktop/To&#34;;
    NSArray *subPaths = [mgr subpathsAtPath:fromPath];
    dispatch_apply(subPaths.count, queue, ^(size_t index) {
        NSString *subPath = subPaths[index];
        NSString *fromFullPath = [fromPath stringByAppendingPathComponent:subPath];
        NSString *toFullPath = [toPath stringByAppendingPathComponent:subPath];
        [mgr moveItemAtPath:fromFullPath toPath:toFullPath error:nil];
    });
}
//å¸¸è§„ç§»åŠ¨æ–‡ä»¶æ“ä½œ
-(void)normalMoveFile{
    // å¸¸è§„æ“ä½œ
    NSFileManager *mgr = [NSFileManager defaultManager];
    NSString *fromPath = @&#34;/User/su/Desktop/Form&#34;;
    NSString *toPath = @&#34;/User/su/Desktop/To&#34;;
    NSArray *subPaths = [mgr subpathsAtPath:fromPath];
    for (NSString *subPath  in subPaths) {
        NSString *fromFullPath = [fromPath stringByAppendingPathComponent:subPath];
        NSString *toFullPath = [toPath stringByAppendingPathComponent:subPath];
        [mgr moveItemAtPath:fromFullPath toPath:toFullPath error:nil];
    }
}
</code></pre><h3 id="gcdé˜Ÿåˆ—ç»„">GCDé˜Ÿåˆ—ç»„</h3>
<p>æˆ‘ä»¬æœ‰çš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°éœ€è¦åˆå¹¶å¤šä¸ªçº¿ç¨‹ä¸­çš„æ‰§è¡Œç»“æœ, ä¾‹å¦‚ä¸‹è½½å¤šä¸ªç´ æåè¿›è¡Œåˆå¹¶; æˆ–è€…æ˜¯ç±»ä¼¼è¿…é›·åˆ†å—ä¸‹è½½åçš„æ–‡ä»¶åˆå¹¶;</p>
<pre tabindex="0"><code>//GCDé˜Ÿåˆ—ç»„
-(void)GCDWithGroup{
    /*
     åˆå¹¶ä¸¤å¼ å›¾ç‰‡æˆ–è€…å¤šä¸ªä»»åŠ¡å¤„ç†å®Œæˆååˆå¹¶ç»“æœ
     */
    //å®šä¹‰ä¸€ä¸ªcå¹¶è¡Œé˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
    //åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ç»„
    dispatch_group_t group = dispatch_group_create();
    //å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ç»„
    dispatch_group_async(group, queue, ^{
        //sub task
    });
    //å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ç»„
    dispatch_group_async(group, queue, ^{
        //sub task
    });
    //å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ç»„
    dispatch_group_async(group, queue, ^{
        //sub task ....
    });
    //ç›‘å¬é˜Ÿåˆ—ç»„å„ä¸ªå­ä»»åŠ¡å®Œæˆåçš„åˆå¹¶
    dispatch_group_notify(group, queue, ^{
        // sub task finish
        //TODO
    });
}
</code></pre><h2 id="nsoperation-nsoperationqueue">NSOPeration NSOperationQueue</h2>
<p>ä¸GCDçš„å®šä¹‰ç±»ä¼¼, ä¹Ÿå­˜åœ¨ä»»åŠ¡å’Œé˜Ÿåˆ—çš„æ¦‚å¿µ,åŸºæœ¬ä¸€è‡´;åœ¨æ­¤å°±ä¸åœ¨é‡å¤å•¦;</p>
<h3 id="nsoperationqueue">NSOperationQueue</h3>
<p>ä»»åŠ¡é˜Ÿåˆ—,å¯ä»¥å¼€å¯ä¸²è¡Œ&amp;å¹¶è¡Œé˜Ÿåˆ— æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>maxConcurrentOperationCount</code>è¿›è¡Œè®¾ç½®,å†³å®šæ˜¯ä»¥ä½•ç§é˜Ÿåˆ—è¿›è¡Œæ‰§è¡Œ</p>
<ul>
<li>maxConcurrentOperationCount é»˜è®¤æƒ…å†µä¸‹ä¸º-1ï¼Œè¡¨ç¤ºä¸è¿›è¡Œé™åˆ¶ï¼Œå¯è¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚</li>
<li>maxConcurrentOperationCount ä¸º1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºä¸²è¡Œé˜Ÿåˆ—ã€‚åªèƒ½ä¸²è¡Œæ‰§è¡Œã€‚</li>
<li>maxConcurrentOperationCount å¤§äº1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºå¹¶å‘é˜Ÿåˆ—ã€‚</li>
</ul>
<h3 id="nsoperation">NSOperation</h3>
<p><code>NSOPeration</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±», ä¸ä½œå…·ä½“äº‹åŠ¡;å…·ä½“äº‹åŠ¡ç”±ä»–çš„å­ç±»è¿›è¡Œæ“ä½œ; ä»–æœ‰ä¸‰ä¸ªå­ç±»</p>
<ul>
<li>ä½¿ç”¨å­ç±» NSInvocationOperation</li>
<li>ä½¿ç”¨å­ç±» NSBlockOperation</li>
<li>è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé€šè¿‡å®ç°å†…éƒ¨ç›¸åº”çš„æ–¹æ³•æ¥å°è£…æ“ä½œã€‚</li>
</ul>
<h4 id="nsinvocationoperation">NSInvocationOperation</h4>
<pre tabindex="0"><code>    NSOperationQueue *queue = [[NSOperationQueue alloc] init];
    //é€šè¿‡suspened å¯ä»¥æ‰§è¡ŒæŒ‚èµ·; ä»»åŠ¡æŒ‚èµ·åå¹¶å’©æœ‰æ¶ˆå¤± , é€šè¿‡è®¾ç½®suspended = NO. ç»§ç»­ä»»åŠ¡
    //æ³¨æ„å¦‚æœå®åœ¨è‡ªå®šä¹‰çš„opå¯¹è±¡æ—¶,æ˜¯å¦éœ€è¦è€ƒè™‘åˆ°ç•Œé¢ä¼˜åŒ–
    //queue.suspended = YES;
    //å®šä¹‰æ“ä½œä»»åŠ¡
    NSInvocationOperation *opOne = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(run:) object:@&#34;xiaoxiaosu&#34;];
    NSInvocationOperation *opTwo = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(run:) object:@&#34;xiaoxiaosu&#34;];
    //æ·»åŠ ä»»åŠ¡
    [queue addOperation:opOne];
    [queue addOperation:opTwo];
</code></pre><h4 id="nsblockoperation">NSBlockOperation</h4>
<pre tabindex="0"><code>//æµ‹è¯•å¹¶è¡ŒOperationQueue
-(void)operationQueue{
/*
    [NSOperationQueue mainQueue]; å¦‚æœä½¿ç”¨mainqueueu, é‚£ä¹ˆè·å–åˆ°çš„æ˜¯ä¸»é˜Ÿåˆ—
    å¦‚æœä½¿ç”¨çš„æ˜¯alloc æ–¹æ³•è·å–,é‚£ä¹ˆæ˜¯ å¹¶è¡Œ
 */
    NSOperationQueue *queue = [[NSOperationQueue alloc] init];
    //è®¾ç½®æœ€å¤§å¹¶å‘æ•°é‡, å€¼å–1çš„æ—¶å€™å¯ä»¥çœ‹åšæ˜¯ä¸²è¡Œé˜Ÿåˆ—
    queue.maxConcurrentOperationCount = 3;
    //é€šè¿‡suspened å¯ä»¥æ‰§è¡ŒæŒ‚èµ·; ä»»åŠ¡æŒ‚èµ·åå¹¶å’©æœ‰æ¶ˆå¤± , é€šè¿‡è®¾ç½®suspended = NO. ç»§ç»­ä»»åŠ¡
    //æ³¨æ„å¦‚æœå®åœ¨è‡ªå®šä¹‰çš„opå¯¹è±¡æ—¶,æ˜¯å¦éœ€è¦è€ƒè™‘åˆ°ç•Œé¢ä¼˜åŒ–
    //queue.suspended = YES;
    //å®šä¹‰æ“ä½œä»»åŠ¡
    NSBlockOperation *opBlock = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@&#34;opBlock&#34;);
    }];
    [opBlock addExecutionBlock:^{
        NSLog(@&#34;opblock add block task&#34;);
    }];
    //æ·»åŠ ä»»åŠ¡
    [queue addOperation:opBlock];
    //è¿˜å¯ä»¥é€šè¿‡blockç›´æ¥æ·»åŠ task
    [queue addOperationWithBlock:^{
    }];
    //å–æ¶ˆæ‰€æœ‰é˜Ÿåˆ—, æ³¨æ„ä¸suspendedçš„åŒºåˆ« ;
//    [queue cancelAllOperations];
}
</code></pre><h4 id="è‡ªå®šä¹‰nsoperationå­ç±»å®ç°">è‡ªå®šä¹‰NSOperationå­ç±»å®ç°</h4>
<p>è¿™ç§å­ç±»ä¸€èˆ¬å¯ä»¥åšæ¯”è¾ƒå¤æ‚çš„æ“ä½œ,æˆ‘ä»¬å¯ä»¥çœå»åœ¨ä¸Šé¢ä¸¤ç§ä»»åŠ¡ä¸­å¤§æ®µåˆé•¿åˆè‡­çš„ä»£ç ,å°è£…åœ¨å­ç±»å®ç°;</p>
<pre tabindex="0"><code>// QKOperation.h æ–‡ä»¶
#import &lt;Foundation/Foundation.h&gt;
@interface QKOperation.h : NSOperation
@end
// QKOperation.h.m æ–‡ä»¶
#import &#34;QKOperation.h&#34;
@implementation QKOperation.h
- (void)main {
    if (!self.isCancelled) {
        for (int i = 0; i &lt; 2; i++) {
            [NSThread sleepForTimeInterval:2];
            NSLog(@&#34;1---%@&#34;, [NSThread currentThread]);
        }
    }
}
@end
</code></pre><h3 id="ä¾èµ–æ“ä½œ">ä¾èµ–æ“ä½œ</h3>
<p>æˆ‘ä»¬æœ‰çš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°è¿™ç§æƒ…å†µ: ä»»åŠ¡1ä¸­çš„æ•°æ®åœ¨ä»»åŠ¡2ä¸­æ˜¯å¿…é¡»çš„,ä¹Ÿå°±æ˜¯è¯´ä»»åŠ¡2æ˜¯ä¾èµ–äºä»»åŠ¡1çš„. åœ¨GCDä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ …æ è¿›è¡Œæ“ä½œ, åœ¨NSOperationä¸­æˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿çš„å¯¹ä»»åŠ¡è¿›è¡Œè®¾ç½®ä¾èµ–;</p>
<pre tabindex="0"><code>//NSOperationçš„ä¾èµ–å’Œç›‘å¬
-(void)opRelyOnOp{
    NSBlockOperation *op1 = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@&#34;task1&#34;);
    }];
    NSBlockOperation *op2 = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@&#34;task2&#34;);
    }];
    NSBlockOperation *op3 = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@&#34;task3&#34;);
    }];
    NSOperationQueue *queue = [[NSOperationQueue alloc] init];
    [queue addOperation:op1];
    [queue addOperation:op2];
    [queue addOperation:op3];
    /*
     å¦‚æœæƒ³è¦è®¾ç½®op3ä¾èµ–op1,2æ‰§è¡Œå®Œæˆåæ‰§è¡Œ,å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„ä»£ç :
     ä¹Ÿså¯ä»¥op3 -&gt; op2  -&gt; op1
     ä½†æ˜¯è¦æ³¨æ„é˜²æ­¢å‡ºç°å¾ªç¯ä¾èµ–: op3 -&gt; op2  -&gt; op1 -&gt; op3
     # ä¹Ÿå¯ä»¥è®¾ç½®ä¸åŒé˜Ÿåˆ—è¿›è¡Œä¾èµ–
     queue queue1 ä¸¤ä¸ªä¸åŒé˜Ÿåˆ—ä¹‹é—´çš„ä»»åŠ¡ä¾èµ–
     */
    [op3 addDependency:op1];
    [op3 addDependency:op2];
    /*
     ç›‘å¬æ“ä½œå®Œæˆ
     */
    op3.completionBlock = ^{
        NSLog(@&#34;op3 task finish&#34;);
    };
}
</code></pre><h3 id="nsoperation-çº¿ç¨‹é€šä¿¡">NSOperation çº¿ç¨‹é€šä¿¡</h3>
<p>å¯ä»¥ä»¥å¾ˆç®€æ˜çš„ä»£ç å®ç°GCDä¸­çš„çº¿ç¨‹é€šä¿¡</p>
<pre tabindex="0"><code>//NSOperation çš„çº¿ç¨‹é€šä¿¡
-(void)opMsg{
    //eg:åˆæˆå›¾ç‰‡
    NSBlockOperation *down1 = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@&#34;img1 download&#34;);
    }];
    NSBlockOperation *down2 = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@&#34;img2 download&#34;);
    }];
    NSBlockOperation *complate = [NSBlockOperation blockOperationWithBlock:^{
        NSLog(@&#34;åˆå¹¶ img1 &amp; img2&#34;);
    }];
    [complate addDependency:down1];
    [complate addDependency:down2];
    //çº¿ç¨‹é—´çš„åŸºæœ¬é€šä¿¡;
    NSOperationQueue *queue = [[NSOperationQueue alloc]init];
    [queue addOperationWithBlock:^{
        NSURL *url = [NSURL URLWithString:@&#34;remoteImgURL&#34;];
        NSData *data = [NSData dataWithContentsOfURL:url];
        UIImage *image = [UIImage imageWithData:data];
        [[NSOperationQueue mainQueue] addOperationWithBlock:^{
            UIImageView *imgview = [UIImageView new];
            imgview.image = image;
        }];
    }];
}
</code></pre><h3 id="nsoperation-çº¿ç¨‹å®‰å…¨">NSOperation çº¿ç¨‹å®‰å…¨</h3>
<pre tabindex="0"><code>-(void)safeSallTicket{
    self.ticketCount = 50;
    NSOperationQueue *queue1 = [[NSOperationQueue alloc] init];
    NSOperationQueue *queue2 = [[NSOperationQueue alloc] init];
    queue1.maxConcurrentOperationCount = queue2.maxConcurrentOperationCount = 1;
    __weak typeof(self) weakSelf = self;
    NSBlockOperation *op1 = [NSBlockOperation blockOperationWithBlock:^{
        [weakSelf sallTicketWithOp];
    }];
    NSBlockOperation *op2 = [NSBlockOperation blockOperationWithBlock:^{
        [weakSelf sallTicketWithOp];
    }];
    [queue1 addOperation:op1];
    [queue2 addOperation:op2];
}
-(void)sallTicketWithOp{
    while (1) {
        // åŠ é”
        [self.lock lock];
        if (self.ticketCount &gt; 0) {
            //å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–
            self.ticketCount--;
            NSLog(@&#34;%@&#34;, [NSString stringWithFormat:@&#34;å‰©ä½™ç¥¨æ•°:%zd çª—å£:%@&#34;, self.ticketCount, [NSThread currentThread]]);
            [NSThread sleepForTimeInterval:0.2];
        }
        // è§£é”
        [self.lock unlock];
        if (self.ticketCount &lt;= 0) {
            NSLog(@&#34;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&#34;);
            break;
        }
    }
}
</code></pre><h3 id="nsoperation-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•">NSOperation å¸¸ç”¨å±æ€§å’Œæ–¹æ³•</h3>
<ul>
<li>å–æ¶ˆæ“ä½œæ–¹æ³•
<ul>
<li>(void)cancel; å¯å–æ¶ˆæ“ä½œï¼Œå®è´¨æ˜¯æ ‡è®° isCancelled çŠ¶æ€ã€‚</li>
</ul>
</li>
<li>åˆ¤æ–­æ“ä½œçŠ¶æ€æ–¹æ³•
<ul>
<li>(BOOL)isFinished; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»ç»“æŸã€‚</li>
<li>(BOOL)isCancelled; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»æ ‡è®°ä¸ºå–æ¶ˆã€‚</li>
<li>(BOOL)isExecuting; åˆ¤æ–­æ“ä½œæ˜¯å¦æ­£åœ¨åœ¨è¿è¡Œã€‚</li>
<li>(BOOL)isReady; åˆ¤æ–­æ“ä½œæ˜¯å¦å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œè¿™ä¸ªå€¼å’Œæ“ä½œçš„ä¾èµ–å…³ç³»ç›¸å…³ã€‚</li>
</ul>
</li>
<li>æ“ä½œåŒæ­¥
<ul>
<li>(void)waitUntilFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¯¥æ“ä½œç»“æŸã€‚å¯ç”¨äºçº¿ç¨‹æ‰§è¡Œé¡ºåºçš„åŒæ­¥ã€‚</li>
<li>(void)setCompletionBlock:(void (^)(void))block; completionBlock ä¼šåœ¨å½“å‰æ“ä½œæ‰§è¡Œå®Œæ¯•æ—¶æ‰§è¡Œ completionBlockã€‚</li>
<li>(void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚</li>
<li>(void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚ @property (readonly, copy) NSArray *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚</li>
</ul>
</li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/ios/">iOS</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/post/yong-bao-yi-xia-chen-mo-de-nsstring-ba/">
        
        

        <div class="article-details">
            <h2 class="article-title">æ‹¥æŠ±ä¸€ä¸‹æ²‰é»˜çš„ NSString å§~</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/post/ios-block-xiang-jie/">
        
        

        <div class="article-details">
            <h2 class="article-title">iOS  blockè¯¦è§£</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/post/nsobject-size/">
        
        

        <div class="article-details">
            <h2 class="article-title">ä» NSObject å ç”¨çš„å†…å­˜è¯´èµ·</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/post/iosarrayforin/">
        
        

        <div class="article-details">
            <h2 class="article-title">iOSä¸­for å’Œ for-in å¾ªç¯æ•°ç»„çš„å°åŒºåˆ«</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/post/kvo/">
        
        

        <div class="article-details">
            <h2 class="article-title">iOSä¸­KVOä½¿ç”¨å’Œåº•å±‚åŸç†</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2017 - 
        
        2023 ç…äººå¯¿
    </section>
    
    <section class="powerby">
        
            <a href="https://beian.miit.gov.cn/" target="_blank">å¤‡æ¡ˆå·</a> <a href="https://beian.miit.gov.cn/" target="_blank">è±«ICPå¤‡18022498å·</a> <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
